<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Painel do Aluno</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://kit.fontawesome.com/3da44e21a2.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="../assets/css/dashboard.css"> 
</head>
<body>
  <div class="app-container">
    <div class="sidebar">
      <div class="sidebar-header">
        <div class="app-icon">
          </div>
      </div>
      <ul class="sidebar-list">
        <li class="sidebar-list-item active" data-target="provas">
          <a href="#">
            <i class="fas fa-file-alt me-2"></i>
            <span>Provas</span>
          </a>
        </li>
        <li class="sidebar-list-item" data-target="redacoes">
          <a href="#">
            <i class="fas fa-pencil-alt me-2"></i>
            <span>Redações</span>
          </a>
        </li>
      </ul>
      <div class="account-info">
        <div class="account-info-picture">
          <img src="https://static.vecteezy.com/system/resources/previews/014/300/061/non_2x/man-profile-glyph-icon-anonymous-photo-for-documents-illustration-vector.jpg" alt="Account">
        </div>
        <span id="nome-aluno">Carregando...</span>
        <button class="account-info-more" id="account-info-more">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
        </button>
        <div class="account-info-menu" id="account-info-menu">
          <button id="logout-button" class="btn btn-danger btn-sm">Sair</button>
        </div>
      </div>
    </div>
    <div class="app-content">
      <div class="app-content-header">
        <h1 class="app-content-headerText" id="page-title">Provas</h1>
      </div>
      <div class="products-area-wrapper tableView" id="conteudo-principal">
        <!-- Conteúdo principal será carregado aqui -->
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <script type="module">
       const firebaseConfig = {
            apiKey: "AIzaSyAbzHqrxU1bfZlCe8LWtizy12-40zdUfDE",
            authDomain: "teste-97fc6.firebaseapp.com",
            projectId: "teste-97fc6",
            storageBucket: "teste-97fc6.appspot.com",
            messagingSenderId: "470428227917",
            appId: "1:470428227917:web:ef9308034050ca366a3f04",
            measurementId: "G-F50QJE3734"
        };

    const app = firebase.initializeApp(firebaseConfig);

    const db = firebase.firestore();
    const auth = firebase.auth();
    const nomeAlunoSpan = document.getElementById('nome-aluno');
    const conteudoPrincipal = document.getElementById('conteudo-principal');
    const pageTitle = document.getElementById('page-title');

    auth.onAuthStateChanged(user => {
      if (user) {
        carregarAluno(user.uid);
      } else {
        window.location.href = '../pages/login-aluno.html'; 
      }
    });

    async function carregarAluno(userId) {
      try {
        const alunoDoc = await db.collection('alunos').doc(userId).get(); 
        if (alunoDoc.exists) {
          const alunoData = alunoDoc.data();
          nomeAlunoSpan.textContent = alunoData.nome;
          carregarProvas(alunoData.serie); 
        } else {
          console.error('Aluno não encontrado no banco de dados!');
          nomeAlunoSpan.textContent = 'Aluno não encontrado';
        }
      } catch (error) {
        console.error('Erro ao carregar dados do aluno:', error);
        nomeAlunoSpan.textContent = 'Erro ao carregar dados';
      }
    }

    const sidebarItems = document.querySelectorAll('.sidebar-list-item');

    sidebarItems.forEach(item => {
      item.addEventListener('click', () => {
        const target = item.dataset.target;

        sidebarItems.forEach(i => i.classList.remove('active'));
        item.classList.add('active');

        if (target === 'provas') {
          pageTitle.textContent = 'Provas';
          carregarProvas();
        } else if (target === 'redacoes') {
          pageTitle.textContent = 'Redações';
          carregarRedacoes();
        }
      });
    }); 

    async function carregarProvas() {
  try {
    conteudoPrincipal.innerHTML = ''; // Limpa o conteúdo anterior

    // Busca todas as provas (sem filtro)
    const provasSnapshot = await db.collection('provas').get();

    if (provasSnapshot.empty) {
      conteudoPrincipal.innerHTML = '<p>Nenhuma prova disponível no momento.</p>';
      return;
    }

    provasSnapshot.forEach(doc => {
    const prova = doc.data();
    const provaElement = `
      <div class="products-row">
        <div class="product-cell category">
          <span class="cell-label">Título:</span> ${prova.titulo}
        </div>
        <div class="product-cell category">
          <span class="cell-label">Descrição:</span> ${prova.descricao}
        </div>
        <div class="product-cell category">
          <a href="/provas/prova.html?id=${doc.id}" class="btn btn-primary">Fazer Prova</a> 
        </div>
      </div>
    `;
    conteudoPrincipal.innerHTML += provaElement;
  });
      } catch (error) {
        console.error('Erro ao carregar provas:', error);
        conteudoPrincipal.innerHTML = '<p>Erro ao carregar provas.</p>';
      }
    }

    async function carregarRedacoes() {
  try {
    conteudoPrincipal.innerHTML = ''; // Limpa o conteúdo anterior

    // Busca todas as redações (sem filtro)
    const redacoesSnapshot = await db.collection('redacoes').get(); 

    if (redacoesSnapshot.empty) {
      conteudoPrincipal.innerHTML = '<p>Nenhuma redação disponível no momento.</p>';
      return;
    }

        redacoesSnapshot.forEach(doc => {
          const redacao = doc.data();
          const redacaoElement = `
            <div class="products-row">
              <div class="product-cell category">
                <span class="cell-label">Tema:</span> ${redacao.tema}
              </div>
              <div class="product-cell category">
                <span class="cell-label">Descrição:</span> ${redacao.descricao}
              </div>
              <div class="product-cell category">
                <a href="../index.html" class="btn btn-primary">Fazer Redação</a>
              </div>
            </div>
          `;
          conteudoPrincipal.innerHTML += redacaoElement;
        });
      } catch (error) {
        console.error('Erro ao carregar redações:', error);
        conteudoPrincipal.innerHTML = '<p>Erro ao carregar redações.</p>';
      }
    }

    // ... (Lógica de Logout)
  </script>
</body>
</html>